{% extends 'layout.html' %}

{% block body %}
<div class="main">
  <div class="send_page col-md-12 col-sm-12">
    <div class="send-total"><span class="pull-left">Send QTUM</span><span class="pull-right">{{ info_output.balance }} QTUM</span></div>
    <form class="send-form col-md-9" method="post" action="{{ url_for('send') }}">
      {{ form.hidden_tag() }}
      <div id="send-wallet" class="input-group">
        <span class="input-group-addon"><i class="glyphicon glyphicon-share-alt"></i></span>
        {{ form.address(type="text", class_="form-control", placeholder="Send to Address")}}
      </div>
      <div id="send-amount" class="input-group">
        <span class="input-group-addon"><i class="glyphicon glyphicon-qrcode"></i></span>
        {{ form.amount(type="number", step="any", class_="form-control", placeholder="Amount to send")}}
      </div>
      <div id="send-description" class="input-group">
        <span class="input-group-addon"><i class="glyphicon glyphicon-floppy-save"></i></span>
        {{ form.description(type="text", class_="form-control", placeholder="Enter description (optional))")}}
      </div>
      <div id="send-to_label" class="input-group">
        <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
        {{ form.to_label(type="text", class_="form-control", placeholder="Enter Name and save it to the address book (optional)")}}
      </div>
      <div id="send-passwd" class="input-group">
        <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
        {{ form.passwd(type="password", class_="form-control", placeholder="Wallet Passphrase")}}
      </div>
      <div id="send-form">
        <button type="submit" class="btn btn-primary btn-sm pull-right">Send Qtum</button>
        {% if form.errors %}
          {% for field, errors in form.errors.items() %}
            <div id="send-alert" class="alert alert-danger">
              {{ form[field].label }}: {{ ', '.join(errors) }}
            </div>
          {% endfor %}
        {% endif %}

        {% with messages = get_flashed_messages(category_filter=["msg"]) %}
          {% if messages %}
            {% for message in messages %}
            <div id="send-alert" class="alert alert-success">
              <a href="https://explorer.qtum.org/tx/{{ message }}"  target="_blank" class="text"><span>{{ message }}</span></a>
            </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {% with messages = get_flashed_messages(category_filter=["error"]) %}
          {% if messages %}
            {% for message in messages %}
            <div id="send-alert" class="alert alert-danger">
              {{ message }}
            </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
      </div>
    </form>
    <div class="send-dropdown col-md-3">
      <button title="Previously saved sent to Names." class="btn btn-primary dropdown-toggle btn-sm" type="button" data-toggle="dropdown">Sent Address Book <span class="caret"></span></button>
      <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="menu1">
        {% for value in last_tx %}
          {% if value.to != nill %}
            <li class="divider"></li>
            <li class="dropdown-header">{{ value.to }}</li>
            <li role="presentation"><a role="menuitem" href="#">{{ value.address }}</a></li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="transactions-send col-md-12">
    <h3>Last Sent Transaction</h3>
    <table class="table table-striped">
      <thead>
        <tr>
          <th class="text-center col-sm-3">Date</th>
          <th class="text-center col-sm-1">Type</th>
          <th class="text-center col-sm-3">Transaction ID</th>
          <th class="text-center col-sm-2">Amount</th>
          <th class="text-center col-sm-1">Fee</th>
          <th class="text-center col-sm-2">Confirmations</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td align="left"><a href="https://explorer.qtum.org/tx/{{last_sent_tx.txid}}" target="_blank">{{ date.strftime('%B %d %Y %I:%M%p %Z', date.localtime(last_sent_tx.time)) }}</a></td>
          <td align="center">
            {% if last_sent_tx.category == "move" %}
              <span class="glyphicon glyphicon-refresh blue"></span>
            {% else %}
              <span class="glyphicon glyphicon-upload red"></span>
            {% endif %}
          </td>
          <td id="table_padding" align="center" class="text"><span>{{ last_sent_tx.txid }}</span></td>
          <td id="table_padding" align="center">{{ last_sent_tx.amount }}</td>
          <td id="table_padding" align="center">{{ last_sent_tx.fee }}</td>
          <td id="table_padding" align="center">{{ last_sent_tx.confirmations }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
